<html>
<head>
    <meta charset="UTF-8">
    <title>Login Page</title>

    <script type="text/javascript" src="media/jQuery-2.1.4/jquery-2.1.4.min.js" ></script>
    <script type="text/javascript" src="media/jQueryUI-1.11.4/jquery-ui.min.js" ></script>
    <link rel="stylesheet" href="media/jQueryUI-1.11.4/jquery-ui.theme.min.css" media="all">
    <link rel="stylesheet" href="login.css" media="all">

    <script type="text/javascript" src="media/md5.js" ></script>

</head>
<body>
    <!--<table id="loginBox">-->
        <!--<tr>-->
            <!--<td><label for="userLoginId">логин</label></td>-->
            <!--<td><input type="text" name="userLogin" id="userLoginId" placeholder="Введите логин"/></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td colspan="2" id="loginError" class="errorText"></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td><label for="userPasswordId">пароль</label></td>-->
            <!--<td><input type="password" name="userPassword" id="userPasswordId" placeholder="Введите пароль"/></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td colspan="2" id="passwordError" class="errorText"></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td colspan="2" align="right"><button id="confirmLoginId">подтвердить</button></td>-->
        <!--</tr>-->
    <!--</table>-->
    <div id="loginBox">
        <div>
            <p><label for="userLoginId"><strong>Логин</strong></label><p>
        </div>
        <div>
            <p>
                <input type="text" name="userLoginId" id="userLoginId" placeholder="Введите логин"/></p>
        </div>
        <div>
            <p><label for="userPasswordId"><strong>Пароль</strong></label> </p>
        </div>
        <div>
            <p><input type="text" name="userPasswordId" id="userPasswordId" placeholder="Введите пароль"/> </p>
        </div>
        <div>
            <p><button id="userLogin" class="lightblue">Подтвердить</button> </p>
        </div>
    </div>


    <script>
        const MIN_PASSWORD_LENGTH = 6;
        var $loginInput = $("#userLoginId");
        var $loginError = $("#loginError");
        var $passwordInput = $("#userPasswordId");
        var $passwordError = $("#passwordError");
        var $inputs = $($loginInput).add($passwordInput);
        var $inputErrors = $loginError.add($passwordError);
        var $confirmLoginBtn = $('#confirmLoginId');

        // make styled view
        $inputs.button().css({
            'font': 'inherit',
            'color': 'inherit',
            'text-align': 'left',
            'outline': 'none',
            'cursor': 'text'
        });

        // if enter pressed then submit
        $inputs.on("keypress", function (e) {
            if (e.which === 13) {
                $confirmLoginBtn.click();
            } else {
                $inputErrors.text("");
            }
        });

        $confirmLoginBtn.on("click", function(e) {
            e.preventDefault();

            if (checkFields()) {

                $.ajax({
                    url: "login",
                    method: "POST",
                    data: {login: $loginInput.val(), password: calcMD5($passwordInput.val())},
                    dataType: "json"
                }).done(function (data) {
                    if (data.redirect) {
                        window.location.href = data.redirect;
                    } else {
                        $loginError.text(data.loginErrorText);
                        $passwordError.text(data.passwordErrorText);
                    }
                })
                  .fail(function () {
                      alert("error");
                });
            }
        });
        $confirmLoginBtn.button();

        // return true or false
        function checkFields() {
            var loginValue = $loginInput.val();
            if (!loginValue) {
                $loginError.text("введите логин");
                $loginInput.focus();
                return false;
            }
            var passwordValue = $passwordInput.val();
            if (!passwordValue) {
                $passwordError.text("введите пароль");
                $passwordInput.focus();
                return false;
            } else if (passwordValue.length < MIN_PASSWORD_LENGTH) {
                $passwordError.text("минимальная длина пароля - " + MIN_PASSWORD_LENGTH + " символов");
                $passwordInput.focus();
                return false;
            }
            return true;
        }

    </script>

</body>
</html>
