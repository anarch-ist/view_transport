
-------------------------------установка mysql---------------------------------------

http://www.debiantutorials.com/install-mysql-server-5-6-debian-7-8/

прежде чем делать update нужно вырубить firewall на сервере, а потом врубить
wget http://dev.mysql.com/get/mysql-apt-config_0.3.5-1debian8_all.deb
dpkg -i mysql-apt-config_0.3.5-1debian8_all.deb
apt-get update 
apt-get install mysql-community-server

просмотреть firewall rules:  iptables -L
перезапуск сетевых служб: ifdown eth0 && ifup eth0
список dns серверов /etc/resolv.confping
проверка как работает dns: dig +short security.debian.org
проблема была в файле настройки /etc/apt/apt.conf в нем нужно было закомментировать все содержимое



Запуск сервера MySQL:
service mysqld start
/etc/init.d/mysql start

Остановка работы сервера MySQL:
service mysqld stop
/etc/init.d/mysql stop

Перезапуск сервера MySQL:
service mysqld restart
/etc/init.d/mysql restart


remoteMysql:
http://www.debianhelp.co.uk/remotemysql.htm

Для того, чтобы mysql стал доступным снаружи надо ему прописать в файле /etc/mysql/my.cnf
bind-address = 185.75.182.94 (для доступа только по одному адресу)
bind-address = 0.0.0.0 (для доступа с любых адресов)
также в этом файле нужно установить max_allowed_packet = 128M в разделах [mysql]?, [mysqld] и в [mysqldump]

затем необходимо разрешить любые входящие ip адреса:
~#  mysql -u root -p 
вводим пароль
mysql> CREATE DATABASE `transmaster_transport_db` CHARACTER SET utf8 COLLATE utf8_bin;
mysql> GRANT ALL PRIVILEGES ON *.* TO root@"%" IDENTIFIED BY 'aftR179Kp' WITH GRANT OPTION;
mysql> exit;
~# mysqladmin -u root -p flush-privileges


тюнинг mysql под сервер 4-8 гб(сейчас это не применено, всё стандартно)
http://linuxguru.ru/administration/mysql-konfig-dlya-servera-s-4-8gb-ozu/



ДЛЯ ТОГО, при нажатии ctrl+shift+f10 всплывало окно выбора datasource необходимо найти окно datasources 
Choose Data Source в статусной строке phpStorm.

-------------------------------оптимизация mysql---------------------------------------


Кэширование запросов

    query_cache_limit — максимальный размер кэшируемого запроса.
    query_cache_min_res_unit — минимальный размер хранимого в кэше блока.
    query_cache_size — размер кэша. 0 отключает использование кэша. Для выбора оптимального значения необходимо наблюдать за переменной состояния Qcache_lowmem_prunes и добиться, чтобы ее значение увеличивалось незначительно. Также нужно помнить, что излишне большой кэш будет создавать ненужную нагрузку.
    query_cache_type — (OFF, DEMAND, ON). OFF отключает кэширование, DEMAND – кэширование будет производиться только при наличии директивы SQL_CACHE в запросе, ON включает кэширование.
    query_cache_wlock_invalidate — определяет будут ли данные браться из кеша, если таблица, к которым они относятся, заблокирована на чтение.

https://habrahabr.ru/post/108418/



low-priority-updates
skip-name-resolve
max_allowed_packet=256M
max_connections=120
thread_cache_size = 16
query_cache_size = 0
key_buffer_size = 3G
max_heap_table_size = 512M
read_buffer_size = 512K
read_rnd_buffer_size=1M
sort_buffer_size=10M
table_open_cache=100


innodb_buffer_pool_size=5G
innodb_flush_log_at_trx_commit=2
innodb_log_file_size=64M





innodb_buffer_pool_size рекомендованное значение 5-6GB (8GB RAM)

innodb_log_file_size = размер redo log(4G или больше)

max_connections — (по умолч - 151)максимальное количество параллельных соединений к серверу. Увеличьте его, если сталкиваетесь с проблемой «Too many connections».

innodb_log_buffer_size   this is the size of the buffer for transactions that have not been committed yet. default 1M. 128M

query_cache_size - лучше всего сразу отключить его и использовать иные способы ускорения запросов. (индексация, дубликаты для расширения пропускной способности для чтения данных, использование внешнего кеша)

log_bin - используется, если сервер используется как реплика. у нас можно выключить.

skip-name-resolve - TRUE (не определять доменные имена для IP-адресов подключающихся клиентов)

low-priority-updates - TRUE ( эта опция снижает приоритет операций INSERT/UPDATE по сравнению с SELECT)

max_allowed_packet - 128МБ(максимальный размер данных, которые могут быть переданы за один запрос)

thread_cache_size = 16 (указывает число кэшируемых потоков, удовенное количество ядер проецессора)

key_buffer              = 1200M

wait_timeout  - время в секундах в течение которого mysql будет поддерживать неактивное соединение

НАСТРОЙКИ:
[mysqld]
port=3306
explicit_defaults_for_timestamp = TRUE
#skip-name-resolve
low-priority-updates
max_allowed_packet = 256M
max_connections = 120
thread_cache_size = 16
query_cache_size = 0
key_buffer_size = 3G
max_heap_table_size = 512M
read_buffer_size = 512K
read_rnd_buffer_size = 1M
sort_buffer_size = 10M
table_open_cache = 100
wait_timeout = 2147483

innodb_buffer_pool_size = 5G
innodb_log_file_size = 1G
innodb_flush_log_at_trx_commit = 2
innodb_lock_wait_timeout = 50

#innodb_data_home_dir = C:\mysql\data/
#innodb_data_file_path = ibdata1:10M:autoextend
#innodb_log_group_home_dir = C:\mysql\data/
#innodb_log_arch_dir = C:\mysql\data/



на уровне php настроить пул соединений к БД




-------------------------------Установка apache 2.4 и PHP 5.6---------------------------------------

apt-get -y install apache2

Apache's default document root is /var/www on Debian, and the configuration file is /etc/apache2/apache2.conf. Additional configurations are stored in subdirectories of the /etc/apache2 directory such as /etc/apache2/mods-enabled (for Apache modules), /etc/apache2/sites-enabled (for virtual hosts), and /etc/apache2/conf-enabled.

установка PHP 5.6
apt-get -y install php5 libapache2-mod-php5
service apache2 restart
проверка, что всё работает
nano /var/www/html/info.php
добавить туда содержание:
<?php
phpinfo();
?>
ставим поддержку mysql
apt-get -y install php5-mysql
service apache2 restart

создание каталога с содержанием сайта
su pigin_s
mkdir public_html

для того, чтобы файлы проекта хранились в каталоге home/pigin_s/public_html нужно открыть файл 

su
nano /etc/apache2/apache2.conf
и в нем закомментировать

#<Directory var/www>
#       Options Indexes FollowSymLinks
#       AllowOverride None
#       Require all granted
#</Directory>

и добавить:

<Directory /home/pigin_s/public_html>
       Options Indexes FollowSymLinks
       AllowOverride None
       Require all granted
</Directory>

затем отредактировать еще один файл, в нем заменить document root на: /home/pigin_s/public_html
nano /etc/apache2/sites-available/000-default.conf

затем нужно выставить разрешение на execute для наших файлов
$ chmod +755 /home/sergey/
$ chmod +755 /home/sergey/public_html/



service apache2 restart


# Ensure that Apache listens on port 80

#Listen 80
#<VirtualHost 192.168.1.37:80>
#    DocumentRoot "/var/www/logist"
#    ServerName www.example.com
#      # Other directives here
#</VirtualHost>


логи apache лежат :
/var/log/apache2/access.log
/var/log/apache2/error.log

-------------------------------УСТАНОВКА FTP server---------------------------------------
УСТАНОВКА FTP server:

http://vacadem.ru/blog/linux-unix-and-other/install-vsftpd-on-debian-7.html
https://wiki.debian.org/ru/vsftpd

aptitude install vsftpd
netstat -npl
настройки сервера vsftpd находятся в файле:
/etc/vsftpd.conf

раскомментировать:
local_umask=022;// с какими начальными permissions будут создаваться файлы или каталоги
write_enables=YES
chroot_local_user=YES

остановка /etc/init.d/vsftpd stop
запуск /etc/init.d/vsftpd start
перезапуск service vsftpd restart

ftp localhost

если возникнет ошибка такого вида
500 OOPS: vsftpd: refusing to run with writable root inside chroot (), то нужно сделать следующее:

chmod a-w /home/pigin_s

чтобы вернуться из режима root нужно ввести su pigin_s



--------------------------УСТАНОВКА JAVA-------------------------------------------------

https://wiki.debian.org/JavaPackage

в /etc/apt/sources.list файле добавить contrib для jessie main. Должно выглядеть как:
deb http://mirror.mephi.ru/debian/ jessie main contrib

установка ПО для сборки пакета java.
apt-get update && apt-get install java-package && exit

скачиваем саму java с сайта oracle и заливаем на сервер при помощи ftp.
server-jre-8u74-linux-x64.tar.gz

Use java-package to create a Debian package, for example: 
make-jpkg server-jre-8u74-linux-x64.tar.gz

при сборке пакета возникла ошибка, для её устранения нужно установить следующие библиотеки
apt-get install libgl1-mesa-glx libfontconfig1 libxslt1.1 libxtst6 libxxf86vm1 libgtk2.0-0

Install the binary package created: 
su
# dpkg -i oracle-java8-jre_8u74_amd64.deb

просмотреть доступные версии java
# update-alternatives --display java
выбрать нужную версию java
# update-alternatives --config java 

java лежит в каталоге usr/lib/jvm/

чтобы проверить работоспособность нужно просто ввести в командную строку: 
java
такая команда должна быть


-----------------------------Разное-----------------------------------------------------
репозитории сервера:

/etc/apt/sources.list
# deb http://mirror.mephi.ru/debian/ jessie main contrib

deb http://mirror.mephi.ru/debian/ jessie main
deb-src http://mirror.mephi.ru/debian/ jessie main

deb http://security.debian.org/ jessie/updates main
deb-src http://security.debian.org/ jessie/updates main

# jessie-updates, previously known as 'volatile'
deb http://mirror.mephi.ru/debian/ jessie-updates main
deb-src http://mirror.mephi.ru/debian/ jessie-updates main

структура каталогов пользователя pigin_s
exchange/data_from_1c -каталог для передачи JSON DATA на сервер
exchange/parser_response -каталог в котором находится ответ parser на полученный пакет из 1c
parser - каталог в котором находится само ПО - parser.
public_html - каталог в котором находятся данные сайта

для того, чтобы через ssh можно было запустить несколько консолей нужно использовать screen

-----------------------------Screen-----------------------------------------------------

Во время работы парсер захватывает поток ввода и вывода. Поэтому его надо запускать в отдельном окне.
Для этого служить приложение - screen.

https://www.rackaid.com/blog/linux-screen-tutorial-and-how-to/#video

su
#apt-get update
#apt-get upgrade
#apt-get install screen

starting screen:
# screen

control command: "ctrl-a"   - перейти в режим ввода команд для приложения screen

create new window(previous window is still active):
# "ctrl-a" "c"

switching between windows:
# "ctrl-a" "n"     (next)
# "ctrl-a" "p"	   (previous)	

detach from screen:
"ctrl-a" "d"

reattach to screen:
screen -r

stopping screen:
type inside all screen windows "exit" or just "ctrl-a" "k"
after screen is terminated you should get a message [screen is terminating].



запуск парсера при помощи screen:
#su
#screen
#cd /home/pigin_s/parser
#su pigin_s
#./startup.sh
#"ctrl-a" "d"

если нужно посмотреть как работает парсер, то просто делаем
su
screen -r


--------------------------УСТАНОВКИ ДЛЯ PHP STORM НОВЫЙ СЕРВЕР--------------------------------------
Настройки для ftp клиента:
ftp host: 185.75.182.94
port 21
root path: /public_html
user name: pigin_s
password: 6RuPd9Kk
adv opt, control encoding: UTF-8

local path: C:\web\wamp\www\sbat.logist.ru
deployment path: /

Поключение к БД:
host: 185.75.182.94
port: 3306
database: ""
user: root
password: aftR179Kp



----------------------УСТАНОВКА redmine------------------------------------------------------------

https://www.redmine.org/projects/redmine/wiki/InstallRedmineOnDebianStableApacheMysqlPassenger


